"use strict";var loginAppp=angular.module("CMSLoginApp",["ngRoute"]);loginAppp.config(function(b,a){a.html5Mode(false);a.hashPrefix("");b.when("/login",{url:"/login",controller:"LoginCtrl",templateUrl:"templates/login-box.html"}).when("/changepassword",{url:"/changepassword",controller:"ChangePasswordCtrl",templateUrl:"templates/changepassword-box.html"}).when("/otp",{url:"/otp",controller:"OTPCtrl",templateUrl:"templates/otp-box.html"}).when("/ForgotPassword",{url:"/ForgotPassword",controller:"ForgotPasswordCtrl",templateUrl:"templates/forgot-password.html"}).otherwise({redirectTo:"/login"})}).run(function(a,b){console.log("Starting login application")});loginAppp.controller("LoginCtrl",["$scope","$rootScope","DataService","$filter","$window",function(c,a,b,d,e){a.AppVersion=version;c.hName=hName;c.LoginButtonText="Log In";c.initCaptcha=function(){try{grecaptcha.render("g-recaptcha",{sitekey:"6Lf5e1UUAAAAAA374n3L-2ZJM64d9qgIGaxvg5c9"})}catch(f){}};c.doLogin=function(){if(!c.LoginForm.$valid){return}c.showLoginErrorMsg=false;a.showLoading=true;var f="username="+c.vm.username+"&password="+c.vm.password+"&g-recaptcha-response="+grecaptcha.getResponse();e.localStorage.username=c.vm.username;b.login_(f).then(function(g){console.log("login response",g);console.debug("Login response:",g.data.data);c.loginSuccessMsg=g.message;e.localStorage.fullName=g.data.data.userInfo.fullName;c.showLoginSuccessMsg=true;e.localStorage.flag="isAuthenticated";e.localStorage.expiryTime=g.data.data.timeout;a.showLoading=false;e.location="#/otp"},function(g){console.log("error......",g.data);if(g.data===null){c.loginErrorMsg="Please check your internet connection"}else{if(g.status===400){c.loginErrorMsg=g.data.message}else{if(g.status==410){c.loginErrorMsg="Sorry password expired please change your passoword before you proceed";e.location="#/changepassword"}else{c.loginErrorMsg=g.data.message}}}grecaptcha.reset();c.showLoginErrorMsg=true;a.showLoading=false})}}]).controller("ChangePasswordCtrl",["$scope","$rootScope","DataService","$window",function(d,a,c,g){d.username=g.localStorage.getItem("username");console.log(d.username);c.getPasswordPolicy().then(function(h){console.log("Password Policy Resp:",h.data.data);d.PasswordPolicy=h.data.data;g.scrollTo(0,0)},function(h){console.log("error......",h.data);if(h.data===null){d.ErrorMsg="Please check your internet connection"}else{if(h.status===400){d.ErrorMsg=h.data.message}else{d.ErrorMsg=h.data.message}}d.showErrorMsg=true});d.changePassword=function(){if(!d.ChangePasswordForm.$valid){return}var h=new FormData();h.append("username",g.localStorage.getItem("username"));h.append("currentPassword",d.vm.currentpassword);h.append("newPassword",d.vm.newpassword);a.showLoading=true;d.showErrorMsg=false;c.changePassword(h).then(function(i){console.log("password change......",i.data.data);a.showLoading=false;window.location="login.html#/login";g.reload()},function(i){console.log("error......",i.data);a.showLoading=false;if(i.data===null){d.ErrorMsg="Please check your internet connection"}else{if(i.status===400){d.ErrorMsg=i.data.message}else{d.ErrorMsg=i.data.message}}d.showErrorMsg=true})};var f=document.getElementById("newpassword"),b=document.getElementById("confirmpassword");function e(){if(f.value!==b.value){b.setCustomValidity("Passwords Don't Match")}else{b.setCustomValidity("")}}f.onchange=e;b.onkeyup=e}]).controller("OTPCtrl",["$scope","$rootScope","DataService","$window",function(c,a,b,d){c.fullName=d.localStorage.getItem("fullName");c.sendOTP=function(){if(!c.OTPForm.$valid){return}a.showLoading=true;b.sendOTP(c.vm.otp).then(function(e){console.log("OTP......",e.data.data);a.showLoading=false;d.localStorage.loggedInUser=angular.toJson(e.data.data.userDetails);d.localStorage.permissions=angular.toJson(e.data.data.permissions);d.localStorage.userType=angular.toJson(e.data.data.userDetails.userType);c.userType=e.data.data.userDetails.userType.userType;console.log(c.userType);if(c.userType==="Bank Operator"){d.location="index.html";d.localStorage.redirect="dashboard"}else{if(c.userType==="Bank Admin"){d.location="index.html#/AdminDashboard";d.localStorage.redirect="AdminDashboard"}else{b.logout().then(function(f){d.localStorage.clear();d.location="login.html"},function(f){d.localStorage.clear();d.location="login.html"})}}},function(e){console.log("Login error......",e.data);a.showLoading=false;if(e.data===null){c.loginErrorMsg="Please check your internet connection"}else{c.loginErrorMsg=e.data.message}c.showLoginErrorMsg=true})};c.resendOTP=function(){a.showLoading=true;b.resendOTP().then(function(e){a.showLoading=false;c.loginSuccessMsg="Resend OTP successfully";c.showLoginSuccessMsg=true},function(e,f){a.showLoading=false;if(e.status===401){c.loginErrorMsg=e.data.message;d.location="login.html#/login"}else{if(e.data===null){c.loginErrorMsg="Please check your internet connection"}else{c.loginErrorMsg=e.data.message}}c.showLoginErrorMsg=true})}}]).controller("ForgotPasswordCtrl",["$scope","$rootScope","DataService","$window",function(c,a,b,d){a.AppVersion=version;c.showLoginErrorMsg=false;c.resetPassword=function(){if(!c.ForgotPasswordForm.$valid){return}a.showLoading=true;var e=new FormData();e.append("email",c.vm.email);b.forgotPassword(e).then(function(f){console.log("forgot password response......",f.data.data);a.showLoading=false;d.location="login.html#/login"},function(f){console.log("change password error......",f.data);a.showLoading=false;if(f.data===null){c.loginErrorMsg="Please check your internet connection"}else{c.loginErrorMsg=f.data.message}c.showLoginErrorMsg=true})}}]);loginAppp.service("DataService",["$http","$window",function(b,a){this.login=function(c){return fetch("process-login",{method:"POST",headers:{"X-CSRF-TOKEN":hValue,Accept:"Application/json"},body:c,credentials:"include"})};this.login_=function(c){return b.post("process-login",c,{headers:{"X-CSRF-TOKEN":hValue,"Content-Type":"application/x-www-form-urlencoded"}})};this.changePassword=function(c){return b.post(urlBase+"users/password",c,{headers:{"X-CSRF-TOKEN":hValue,"Content-Type":undefined}})};this.sendOTP=function(c){return b.post(urlBase+"otp/verification?&userIp=192.168.8.675&userAgent=Browser/Application&otp="+c,{},{headers:{"X-CSRF-TOKEN":hValue}})};this.resendOTP=function(){return b.get(urlBase+"otp/resend",{headers:{"X-CSRF-TOKEN":hValue,"Content-Type":undefined}})};this.forgotPassword=function(c){console.log("email",c);console.log("access_token:",a.localStorage.getItem("access_token"));return b.post(urlBase+"users/forgot-password",c,{headers:{"X-CSRF-TOKEN":hValue,"Content-Type":undefined}})};this.getPasswordPolicy=function(){return b.get(urlBase+"sys-config/password",{headers:{"X-CSRF-TOKEN":hValue,"Content-Type":undefined}})};this.logout=function(){return b.post("/logout",{},{headers:{"X-CSRF-TOKEN":hValue}})}}]);loginAppp.directive("numbersOnly",function(){return{require:"ngModel",link:function(e,d,a,c){function b(g){if(g){var f=g.replace(/[^0-9]/g,"");if(f!==g){c.$setViewValue(f);c.$render()}return f}return undefined}c.$parsers.push(b)}}}).directive("required",function(){return{link:function(c,b,a){b.addClass("required_asterisk")}}});var version="1.0";var urlBase="/";var urlBase="api/";var idleTimeout=15*60;var hValue=document.head.querySelector("[name=_csrf]").content;var hName=document.head.querySelector("[name=_csrf_header]").content;