"use strict";loginAppp.controller("LoginCtrl",["$scope","$rootScope","DataService","$filter","$window",function(c,a,b,d,e){a.AppVersion=version;c.hName=hName;c.doLogin=function(){if(!c.LoginForm.$valid){return}var f=new FormData();f.append("username",c.vm.username);f.append("password",c.vm.password);e.localStorage.username=c.vm.username;a.showLoading=true;b.login(f).then(function(g){return g.json()}).then(function(g){console.log("Logging response",g);a.showLoading=false;if(g.code===200){e.localStorage.flag="isAuthenticated";e.location="#/otp"}else{c.loginErrorMsg=g.message;c.showLoginErrorMsg=true;a.showLoading=false;if(g.code===410){e.location="#/changepassword"}else{alert(g.message)}}})}}]).controller("ChangePasswordCtrl",["$scope","$rootScope","DataService","$window",function(c,a,b,d){c.username=d.localStorage.getItem("username");console.log(c.username);b.getPasswordPolicy().then(function(e){console.log("Password Policy Resp:",e.data.data);c.PasswordPolicy=e.data.data;d.scrollTo(0,0)},function(e){console.log("error......",e.data);if(e.data===null){c.ErrorMsg="Please check your internet connection"}else{if(e.status===400){c.ErrorMsg=e.data.message}else{c.ErrorMsg=e.data.message}}c.showErrorMsg=true});c.changePassword=function(){if(!c.ChangePasswordForm.$valid){return}var e=new FormData();e.append("username",d.localStorage.getItem("username"));e.append("currentPassword",c.vm.currentpassword);e.append("newPassword",c.vm.newpassword);a.showLoading=true;b.changePassword(e).then(function(f){console.log("password change......",f.data.data);a.showLoading=false;window.location="login.html#/login"},function(f){console.log("error......",f.data);a.showLoading=false;if(f.data===null){c.ErrorMsg="Please check your internet connection"}else{if(f.status===400){c.ErrorMsg=f.data.message}else{c.ErrorMsg=f.data.message}}c.showErrorMsg=true})}}]).controller("OTPCtrl",["$scope","$rootScope","DataService","$window",function(c,a,b,d){c.sendOTP=function(){if(!c.OTPForm.$valid){return}a.showLoading=true;b.sendOTP(c.vm.otp).then(function(e){console.log("OTP......",e.data.data);a.showLoading=false;d.localStorage.loggedInUser=angular.toJson(e.data.data.userDetails);d.localStorage.permissions=angular.toJson(e.data.data.permissions);c.userType=e.data.data.userDetails.userType;console.log(c.userType);if(c.userType==="Bank Operator"||c.userType==="Bank Admin"){d.location="index.html"}else{b.logout().then(function(f){d.localStorage.clear();d.location="login.html"},function(f){d.localStorage.clear();d.location="login.html"})}},function(e){console.log("Login error......",e.data);a.showLoading=false;if(e.data===null){c.loginErrorMsg="Please check your internet connection"}else{c.loginErrorMsg=e.data.message}c.showLoginErrorMsg=true})}}]).controller("ForgotPasswordCtrl",["$scope","$rootScope","DataService","$window",function(c,a,b,d){a.AppVersion=version;c.showLoginErrorMsg=false;c.resetPassword=function(){if(!c.ForgotPasswordForm.$valid){return}a.showLoading=true;var e=new FormData();e.append("email",c.vm.email);b.forgotPassword(e).then(function(f){console.log("forgot password response......",f.data.data);a.showLoading=false;d.location="login.html#/login"},function(f){console.log("change password error......",f.data);a.showLoading=false;if(f.data===null){c.loginErrorMsg="Please check your internet connection"}else{c.loginErrorMsg=f.data.message}c.showLoginErrorMsg=true})}}]);